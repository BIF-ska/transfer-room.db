# Initiating Alembic

To initiate Alembic, you need to create an Alembic environment. You can do this by running the following command in your terminal:

```sh
alembic init alembic
```

This will create a directory named `alembic` in your project directory. This directory will contain the following files:

- `alembic.ini`: This file contains the configuration settings for Alembic.

- `env.py`: This file contains the environment setup for Alembic.

- `script.py.mako`: This file is a template for generating migration scripts.

- `versions/`: This directory will contain the migration scripts generated by Alembic.

Once you have created the Alembic environment, you can start using Alembic to manage your database schema.

You have to configure the `alembic.ini` file to connect to your database. You can do this by updating the `sqlalchemy.url` setting in the `alembic.ini` file with the connection string for your database.

this line in the `alembic.ini` file has to be removed:

```sh
sqlalchemy.url = driver://user:pass@localhost/dbname
```

and the env.py file has to be updated with the following code:

```sh
import os

from logging.config import fileConfig

from sqlalchemy import engine_from_config
from sqlalchemy import pool

from alembic import context

from dotenv import load_dotenv
load_dotenv()

# this is the Alembic Config object, which provides
# access to the values within the .ini file in use.
config = context.config

# Interpret the config file for Python logging.
# This line sets up loggers basically.
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

target_metadata = None

def run_migrations_offline() -> None:
    """Run migrations in 'offline' mode.

    This configures the context with just a URL
    and not an Engine, though an Engine is acceptable
    here as well.  By skipping the Engine creation
    we don't even need a DBAPI to be available.

    Calls to context.execute() here emit the given string to the
    script output.

    """
    url = config.get_main_option("sqlalchemy.url", os.getenv('DATABASE_URL'))
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()


def run_migrations_online() -> None:
    """Run migrations in 'online' mode.

    In this scenario we need to create an Engine
    and associate a connection with the context.

    """
    configuration = config.get_section(config.config_ini_section)
    configuration['sqlalchemy.url'] = config.get_main_option("sqlalchemy.url", os.getenv('DATABASE_URL'))
    connectable = engine_from_config(
        configuration,
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection,
            target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()


if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()
```

This code will load the database URL from the environment variable `DATABASE_URL` and use it to connect to the database.

Now you can start creating migration scripts using Alembic.

# Creating a Migration Script

To create a migration script, you need to run the following command in your terminal:

```sh
alembic revision -m "create_table"
```

This will create a new migration script in the `versions/` directory with the name `create_table.py`. You can open this file and add the necessary changes to the database schema.

The migration script will contain two functions: `upgrade()` and `downgrade()`. The `upgrade()` function will contain the changes to be applied to the database schema, while the `downgrade()` function will contain the changes to be reverted.

You can add the necessary changes to the `upgrade()` function, such as creating tables, adding columns, or modifying constraints. Once you have added the changes, you can apply the migration script to the database.

# Applying a Migration Script

To apply a migration script, you need to run the following command in your terminal:

```sh
alembic upgrade head
```

This will apply the migration script to the database and update the schema accordingly.

You can also revert a migration script by running the following command:

```sh
alembic downgrade -1
```